<!-- -*- mode:jinja2 -*- -->
{% extends "base.html" %}

{% block pagetitle %}
  <span class="ds-primary-title">{{config['DASHBOARD_APPNAME']}}</span> <span class="ds-secondary-title">{{title}}</span>
{% endblock %}

{% block content %}

  <div class="container">

    {% include "snippets/breadcrumbs.html" %}

    <div class="row">
      <div class="col-md-8">
        {% if tag %}
          <h3>Dashboards</h3>
        {% else %}
          <h3>All Dashboards</h3>
        {% endif %}
        <div id="ds-dashboard-main-listing"></div>
      </div>
      <div class="col-md-4">
        <h3>Actions</h3>
        <ul class="list-group">
          <li class="list-group-item"><a href="/dashboards/create/">New dashboard&hellip;</a></li>
        </ul>
        <h3>Tags</h3>
        <div id="ds-dashboard-tag-listing"></div>
      </div>
    </div>
  </div> <!-- container -->

  <script>
    {% if tag %}
      var path = '/api/dashboard/tagged/{{tag}}';
    {% else %}
      var path = '/api/dashboard/';
    {% endif %}
    ds.manager.list(path, function(data) {
      var rendered = ds.templates.listing.dashboard_list(data);
      $("#ds-dashboard-main-listing").html(rendered);
    });

    $.ajax({
      dataType: 'json',
      url: '/api/tag/'
    }).done(function(data) {
      var context = { tags: data.tags };
    {% if tag %}
      context.tag = '{{ tag }}';
    {% endif %}
      var rendered = ds.templates.listing.dashboard_tag_list(context);
      $("#ds-dashboard-tag-listing").html(rendered);
      $("[data-ds-tag={{tag}}]").addClass("active");
    });
  </script>

{% endblock %}
