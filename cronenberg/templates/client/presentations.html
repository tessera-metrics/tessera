{% raw %}

<!--
     TEMPLATE: Singlestat presentation.
  -->
<script id="ds-tmpl-singlestat" data-ds-item-type="singlestat" type="text/x-handlebars-template">
  <div class="ds-presentation ds-singlestat {{item.css_class}} {{height item}}" id="{{item.element_id}}">
    <h3>{{item.title}}</h3>
    <p><span class="value"></span><span class="unit">{{item.units}}</span></p>
  </div>
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-singlestat', dataHandler: function(query, item) {
      var element = $('#' + item.element_id + ' span.value');
      var value = query.summation[item.transform];
      if (item.index) {
          value = query.data[item.index].summation[item.transform];
      }
      cronenberg.check_thresholds(item, value, '#' + item.element_id);
      element.text(d3.format(item.format)(value));
  }});
</script>


<!--
     TEMPLATE: Jumbotron Singlestat presentation.
  -->
<script id="ds-tmpl-jumbotron-singlestat" data-ds-item-type="jumbotron_singlestat" type="text/x-handlebars-template">
  <div class="ds-presentation ds-jumbotron-singlestat {{height item}} {{css_class item}}"
       id="{{item.element_id}}">
    <div><p><span class="value"></span><span class="unit">{{item.units}}</span></p></div>
    <div><h3>{{item.title}}</h3></div>
  </div>
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-jumbotron-singlestat', dataHandler: function(query, item) {
      var element = $('#' + item.element_id + ' span.value');
      var value = query.summation[item.transform];
      if (item.index) {
          value = query.data[item.index].summation[item.transform];
      }
      cronenberg.check_thresholds(item, value, '#' + item.element_id);
      $(element).text(d3.format(item.format)(value));
  }});
</script>

<!--
     TEMPLATE: Simple time series presentation.
  -->
<script id="ds-tmpl-simple-time-series" data-ds-item-type="simple_time_series" type="text/x-handlebars-template">
  <div class="ds-presentation ds-graph ds-simple-time-series {{css_class item}}" id="{{item.element_id}}">
    {{> ds-title-bar}}
    <div class="ds-graph-holder">
      <svg class="{{height item}}"></svg>
    </div>
  </div>
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-simple-time-series', dataHandler: function(query, item) {
      if (!item.interactive) {
          var element = $('#' + item.element_id + ' svg');
          var png_url = cronenberg.charts.chart_url(item, {
              height: element.height(),
              width: element.width()
          });
          element.parent().html($('<img/>').attr('src', png_url));
      } else {
          if (item.filled) {
              cronenberg.charts.simple_area_chart($("#" + item.element_id + ' .ds-graph-holder'), query.data[0], item.options);
          } else {
              cronenberg.charts.simple_line_chart($("#" + item.element_id + ' .ds-graph-holder'), query.data[0], item.options);
          }
      }
  }});
</script>

<!--
     TEMPLATE: SingleGraph presentation.
  -->
<script id="ds-tmpl-single-graph" data-ds-item-type="singlegraph" type="text/x-handlebars-template">
  <div class="ds-presentation ds-graph ds-singlegraph {{css_class item}}" id="{{item.element_id}}">
    {{> ds-title-bar}}
    <div class="ds-graph-holder">
      <svg class="{{height item}}"></svg>
      <span class="ds-label"></span>
      <span class="value"></span>
    </div>
  </div>
  <!-- <span class="unit">{{item.units}}</span> -->
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-single-graph', dataHandler: function(query, item) {
      if (!item.interactive) {
          var element = $('#' + item.element_id + ' svg');
          var png_url = cronenberg.charts.chart_url(item, {
              height: element.height(),
              width: element.width()
          });
          element.parent().html($('<img/>').attr('src', png_url));
      } else {
          cronenberg.charts.simple_area_chart($("#" + item.element_id + ' .ds-graph-holder'), query.data[0], item.options);
      }
  item.options.margin = { top: 0, left: 0, bottom: 0, right: 0 };
      var label = query.data[item.index || 0].key;
      var value = query.summation[item.transform];
      if (item.index) {
          value = query.data[item.index].summation[item.transform];
      }
  // TODO - the thresholding will probably mess up this one
  cronenberg.check_thresholds(item, value, '#' + item.element_id);
      $('#' + item.element_id + ' span.value').text(d3.format(item.format)(value));
      $('#' + item.element_id + ' span.ds-label').text(label);
  }});
</script>


<!--
     TEMPLATE: Standard time series presentation.
  -->
<script id="ds-tmpl-standard-time-series" data-ds-item-type="standard_time_series" type="text/x-handlebars-template">
  <div class="ds-presentation ds-graph ds-standard-time-series {{css_class item}}"
       id="{{item.element_id}}">
    {{> ds-title-bar}}
    <div class="ds-graph-holder">
      <svg class="{{height item}}"></svg>
    </div>
  </div>
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-standard-time-series', dataHandler: function(query, item) {
      if (!item.interactive) {
          var element = $('#' + item.element_id + ' svg');
          var png_url = cronenberg.charts.chart_url(item, {
              height: element.height(),
              width: element.width()
          });
          element.parent().html($('<img/>').attr('src', png_url).height(element.height()).width(element.width()));
      } else {
          var chart = cronenberg.charts.standard_line_chart($("#" + item.element_id + ' .ds-graph-holder'), query.data, item.options);
      }

  }});
</script>

<!--
     TEMPLATE: Stacked area chart presentation.
  -->
<script id="ds-tmpl-stacked-area-chart" data-ds-item-type="stacked_area_chart" type="text/x-handlebars-template">
  <div class="ds-presentation ds-graph ds-stacked-area-chart {{css_class item}}"
       id="{{item.element_id}}">
    {{> ds-title-bar}}
    <div class="ds-graph-holder">
      <svg class="{{height item}}"></svg>
    </div>
  </div>
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-stacked-area-chart', dataHandler: function(query, item) {
      if (!item.interactive) {
          var element = $('#' + item.element_id + ' svg');
          var png_url = cronenberg.charts.chart_url(item, {
              height: element.height(),
              width: element.width()
          });
          element.parent().html($('<img/>').attr('src', png_url));
      } else {
         cronenberg.charts.stacked_area_chart($("#" + item.element_id + ' .ds-graph-holder'), query.data, item.options);
      }
  }});
</script>

<!--
     TEMPLATE: Donut chart presentation.
  -->
<script id="ds-tmpl-donut-chart" data-ds-item-type="donut_chart" type="text/x-handlebars-template">
  <div class="ds-presentation ds-graph ds-donut-chart {{css_class item}}"
       id="{{item.element_id}}">
    {{> ds-title-bar}}
    <div class="ds-graph-holder">
      <svg class="{{height item}}"></svg>
    </div>
  </div>
</script>
<script>
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-donut-chart', dataHandler: function(query, item) {
      var chart = cronenberg.charts.donut_chart($("#" + item.element_id + ' .ds-graph-holder'), query.data, item.options);
  }});
</script>


<!--
     TEMPLATE: Summation table presentation.
  -->
<script id="ds-tmpl-summation-table" data-ds-item-type="summation_table" type="text/x-handlebars-template">
  <table class="ds-presentation table table-condensed ds-summation-table {{height item}} {{css_class item}}
                {{#if item.striped}}table-striped{{/if}}"
         id="{{item.element_id}}">
    <thead>
      <tr>
        <th></th>
        <th>latest</th>
        <th>min</th>
        <th>max</th>
        <th>mean</th>
        <th>sum</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</script>
<!-- Summation table row template, takes a context of { series: series, item: item } -->
<script id="ds-tmpl-summation-table-row" type="text/x-handlebars-template">
  <tr>
    <td>{{series.key}}</td>
    <td>{{format item.format series.summation.last}}</td>
    <td>{{format item.format series.summation.min}}</td>
    <td>{{format item.format series.summation.max}}</td>
    <td>{{format item.format series.summation.mean}}</td>
    <td>{{format item.format series.summation.sum}}</td>
  </tr>
</script>
<script>
  var rowTemplate = Handlebars.compile($("#ds-tmpl-summation-table-row").html());
  var handler = function(query, item) {
      var body = $('#' + item.element_id + ' tbody');
      query.data.forEach(function(series) {
          body.append(rowTemplate({series:series, item:item}));
      });
  };
  cronenberg.templates.register_presentation({ elementId: 'ds-tmpl-summation-table', dataHandler: handler});
</script>

{% endraw %}
